'use strict';

exports.__esModule = true;
exports.createPACServer = createPACServer;

var _http = require('http');

var _gfwlistUtils = require('./gfwlistUtils');

var NAME = 'pac_server';

// TODO: async this
// eslint-disable-next-line
function createPACServer(config, logger) {
  var pacFileContent = (0, _gfwlistUtils.getPACFileContent)(config);
  var HOST = config.localAddr + ':' + config.pacServerPort;

  var server = (0, _http.createServer)(function (req, res) {
    res.write(pacFileContent);
    res.end();
  });

  server.on('error', function (err) {
    logger.error(NAME + ' got error: ' + err.stack);
  });

  server.listen(config.pacServerPort);

  if (logger) {
    logger.verbose(NAME + ' is listening on ' + HOST);
  }

  return server;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYWNTZXJ2ZXIuanMiXSwibmFtZXMiOlsiY3JlYXRlUEFDU2VydmVyIiwiTkFNRSIsImNvbmZpZyIsImxvZ2dlciIsInBhY0ZpbGVDb250ZW50IiwiSE9TVCIsImxvY2FsQWRkciIsInBhY1NlcnZlclBvcnQiLCJzZXJ2ZXIiLCJyZXEiLCJyZXMiLCJ3cml0ZSIsImVuZCIsIm9uIiwiZXJyIiwiZXJyb3IiLCJzdGFjayIsImxpc3RlbiIsInZlcmJvc2UiXSwibWFwcGluZ3MiOiI7OztRQU9nQkEsZSxHQUFBQSxlOztBQVBoQjs7QUFDQTs7QUFFQSxJQUFNQyxPQUFPLFlBQWI7O0FBRUE7QUFDQTtBQUNPLFNBQVNELGVBQVQsQ0FBeUJFLE1BQXpCLEVBQWlDQyxNQUFqQyxFQUF5QztBQUM5QyxNQUFNQyxpQkFBaUIscUNBQWtCRixNQUFsQixDQUF2QjtBQUNBLE1BQU1HLE9BQVVILE9BQU9JLFNBQWpCLFNBQThCSixPQUFPSyxhQUEzQzs7QUFFQSxNQUFNQyxTQUFTLHdCQUFhLFVBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQ3hDQSxRQUFJQyxLQUFKLENBQVVQLGNBQVY7QUFDQU0sUUFBSUUsR0FBSjtBQUNELEdBSGMsQ0FBZjs7QUFLQUosU0FBT0ssRUFBUCxDQUFVLE9BQVYsRUFBbUIsVUFBQ0MsR0FBRCxFQUFTO0FBQzFCWCxXQUFPWSxLQUFQLENBQWdCZCxJQUFoQixvQkFBbUNhLElBQUlFLEtBQXZDO0FBQ0QsR0FGRDs7QUFJQVIsU0FBT1MsTUFBUCxDQUFjZixPQUFPSyxhQUFyQjs7QUFFQSxNQUFJSixNQUFKLEVBQVk7QUFDVkEsV0FBT2UsT0FBUCxDQUFrQmpCLElBQWxCLHlCQUEwQ0ksSUFBMUM7QUFDRDs7QUFFRCxTQUFPRyxNQUFQO0FBQ0QiLCJmaWxlIjoicGFjU2VydmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlU2VydmVyIH0gZnJvbSAnaHR0cCc7XG5pbXBvcnQgeyBnZXRQQUNGaWxlQ29udGVudCB9IGZyb20gJy4vZ2Z3bGlzdFV0aWxzJztcblxuY29uc3QgTkFNRSA9ICdwYWNfc2VydmVyJztcblxuLy8gVE9ETzogYXN5bmMgdGhpc1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUEFDU2VydmVyKGNvbmZpZywgbG9nZ2VyKSB7XG4gIGNvbnN0IHBhY0ZpbGVDb250ZW50ID0gZ2V0UEFDRmlsZUNvbnRlbnQoY29uZmlnKTtcbiAgY29uc3QgSE9TVCA9IGAke2NvbmZpZy5sb2NhbEFkZHJ9OiR7Y29uZmlnLnBhY1NlcnZlclBvcnR9YDtcblxuICBjb25zdCBzZXJ2ZXIgPSBjcmVhdGVTZXJ2ZXIoKHJlcSwgcmVzKSA9PiB7XG4gICAgcmVzLndyaXRlKHBhY0ZpbGVDb250ZW50KTtcbiAgICByZXMuZW5kKCk7XG4gIH0pO1xuXG4gIHNlcnZlci5vbignZXJyb3InLCAoZXJyKSA9PiB7XG4gICAgbG9nZ2VyLmVycm9yKGAke05BTUV9IGdvdCBlcnJvcjogJHtlcnIuc3RhY2t9YCk7XG4gIH0pO1xuXG4gIHNlcnZlci5saXN0ZW4oY29uZmlnLnBhY1NlcnZlclBvcnQpO1xuXG4gIGlmIChsb2dnZXIpIHtcbiAgICBsb2dnZXIudmVyYm9zZShgJHtOQU1FfSBpcyBsaXN0ZW5pbmcgb24gJHtIT1NUfWApO1xuICB9XG5cbiAgcmV0dXJuIHNlcnZlcjtcbn1cbiJdfQ==